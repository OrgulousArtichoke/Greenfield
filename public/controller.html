<html>
<body>
<h1>This is a game controller. </h1>
<div id="phaser-example"></div>
</body>

<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
<script type="text/javascript" src="./lib/phaser.min.js"></script>

<script type="text/javascript">
var game = new Phaser.Game(450, 150, Phaser.AUTO, 'phaser-example');
var socket = io();

//some global vars 
var left=false;
var right=false;
var up = false;
var jump=false;


function preload() {
    //spritesheet for animations
    //background, ground, fireball images
    game.load.image('ground', './assets/ground.png');    //gamepad buttons
    
    game.load.spritesheet('buttonhorizontal', 'square.png',96,96);
    game.stage.backgroundColor = '#666';

    // // fullscreen setup
    // game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
    // game.scale.fullScreenScaleMode = Phaser.ScaleManager.EXACT_FIT;
}
function gofull() { game.scale.startFullScreen(false);}
function create() {
    // if (!game.device.desktop){ game.input.onDown.add(gofull, this); } //go fullscreen on mobile devices
    
    //On create, instantiate new player
    socket.emit('new player', {});


    this.platforms = game.add.group();
    this.platforms.enableBody = true;
    
    //Create Ground
      this.ground = [];
      for (var i = 0; i < game.world.width; i+=70) {
        this.ground.push(this.platforms.create(i, game.world.height - 70, 'ground'));
      }
      for (var j = 0; j < this.ground.length; j++) {
        this.ground[j].body.immovable = true;
      }
    // create our virtual game controller buttons 
    // buttonjump = game.add.button(600, 500, 'buttonjump', null, this, 0, 1, 0, 1);  //game, x, y, key, callback, callbackContext, overFrame, outFrame, downFrame, upFrame

    buttonleft = game.add.button(0, 0, 'buttonhorizontal', null, this, 0, 1, 0, 1);
        buttonleft.events.onInputDown.add(function(){left=true;});
        buttonleft.events.onInputUp.add(function(){left=false;});

    buttonjump = game.add.button(150, 0, 'buttonhorizontal', null, this, 0, 1, 0, 1);
        buttonjump.events.onInputDown.add(function(){up=true;});
        buttonjump.events.onInputUp.add(function(){up=false;});


    buttonright = game.add.button(300, 0, 'buttonhorizontal', null, this, 0, 1, 0, 1);
        buttonright.events.onInputDown.add(function(){right=true;});
        buttonright.events.onInputUp.add(function(){right=false;});
};

function update() {
    // define what should happen when a button is pressed
    if (left) {
     socket.emit('left button', {});
    }
    if (right) {
      socket.emit('right button', {});      
    }
    if (up) {
     socket.emit('up button', {});
    }
    if (game.input.currentPointers == 0 && !game.input.activePointer.isMouse){right=false; left=false; jump=false;
    } //this works around a "bug" where a button gets stuck in pressed state
};

function render(){
    game.debug.text('left:' + left + ' right:' + right, 20, 120);
}

game.state.add('main', { preload: preload, create: create, update:update,render:render });
game.state.start('main');
</SCRIPT>
</html>